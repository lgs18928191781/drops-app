<template>
  <div class="image">
    <ElSkeleton :loading="isSkeleton" animated>
      <template #template>
        <ElSkeletonItem variant="image" />
      </template>
      <template #default>
        <!-- <img ref="imgRef" :data-src="url" :class="imageClass" @error="fail" loading="lazy" /> -->
        <img ref="imgRef" :src="url" :class="imageClass" @error="fail" loading="lazy" />
      </template>
    </ElSkeleton>
  </div>
</template>

<script setup lang="ts">
import { computed, ref, watch } from 'vue'
// import 'lazysizes'
import { DB } from '@/utils/db'
import { metafile } from '@/utils/filters'

const Default = {
  metafile:
    'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPSIjOTA5Mzk5IiB0PSIxNjU2MDc5MTEyMDU5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE4NDk0IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsgc3JjOiB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmYyP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZjIiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoInRydWV0eXBlIik7IH0KPC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTY5Ni40MyA0NjUuMjVjNDAuNjEgMCA3My41My0zMi43MiA3My41My03My4wOXMtMzIuOTYtNzMuMDgtNzMuNTMtNzMuMDgtNzMuNTQgMzIuNzItNzMuNTQgNzMuMDggMzIuOTIgNzMuMDkgNzMuNTQgNzMuMDl6TTUzNS43NCA2NTAuNjJsLTI3My42MS0yNTkuNGE1Ni4xOSA1Ni4xOSAwIDAgMC0xNS4zNiAxMS41OGwtMTE0IDExOS42My02LTIyMi43N2MtMC43My0yNi44MiAyMC44NC00OS40MSA0Ny42Ny01MC4xNGwyMDEuNzctNS40NCA0Ny4zNC01MC0yNTAuNDMgNi43NUMxMTkgMjAyLjMzIDc2LjMzIDI0Ny4xNyA3Ny43OCAzMDFsNy4zMiAyNzEuNCA0LjUgMTY2Ljc4QzkxLjA2IDc5MyAxMzYuMDUgODM1LjQ3IDE5MC4yIDgzNGwxNzYtNC43NSAxMi0wLjMyIDQ3LjM0LTUwIDExNi4xOC0xMjIuNjR6IiBwLWlkPSIxODQ5NSI+PC9wYXRoPjxwYXRoIGQ9Ik04NjEuNzEgMjE0LjhsLTI0Mi44My0zMy44Ni01NS4wOSA0MS40Nkw4NTUgMjYzYTQ5LjA1IDQ5LjA1IDAgMCAxIDQxLjc5IDU1LjEzbC01NC4zMyAzODkuNTktMTIwLjg3LTE1OS4wNUE1OS44NiA1OS44NiAwIDAgMCA2MzguMDYgNTM3bC00NCAzMy4wOCA2NS4wNyA4Ni4xNUw2MDMuODQgNjk4bC03OS41NyA2MC4xLTU0LjkyIDQxLjQ4IDM0LjE3IDQuNzYgMjcwLjczIDM3Ljc2YTk3LjU1IDk3LjU1IDAgMCAwIDEwOS44OC03OS42IDIyLjM3IDIyLjM3IDAgMCAwIDAuNjUtMy40NGw2MC41My00MzQuMTZjNy40NC01My4zMi0yOS45NS0xMDIuNjItODMuNi0xMTAuMXoiIHAtaWQ9IjE4NDk2Ij48L3BhdGg+PC9zdmc+',
  metaId:
    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAYAAABRRIOnAAAXVklEQVR4Ae3Be6yk933X8ffn+3ueZ+bMue7Zszfvru31ZmObre+nSUlawI0apDSVWkJIBe1fBVpQWwQIVZWAun8gtQKpQKGlKlIl2krEUVSklBRIwwZanJgeZ+1UW9ux14699/uZc5uZ53l+vy9njY81XXnXe/XujOf1EgPqwIED2eTk/UUIvcIsFuBFXTebVtS7Uqx3ubPbgu5yT3fL2e5iCmcKmDazcXfnSiSRUloF2oglOUsuTsr1ZvJ0XLIjFrKjqcyOZlm3CypTCmWMjXJ5+eXyySefrBlAYkAsLLw8l4J2BdNukx502CX3HY62CbY6bLdg07izwd3Z4O7cCElskMQ7JFJMbcHJRDotOIXshOBocn8xJj9i0Y/Oz99/lgEg7kBf/vIrjbvu1sdS7Y85fn8Wwq6Y0nbcd+VFsTXPC1KKpJRIyXFPpJRwd24HSZgZkmEmzAyzQFWVVGV5GuloMDtZx3gU9FJAzx8/7s986lP7etxhxB3gwIHXm5vuyjZ7r/fd4J9KzveZtMPdJ4uisBACMSZSisQYcXcGgSRCCJgFQjBijJRlFSVWkvsJ4I+yLPx+DNnCZOid27dvX4/bTNxGf/qnr+ytUvq4LHyC5J+wLNuJO+6OO+scd2eYSAKEBJKQRF3XxyzYV2KdvuqBr88/tO8wt4l4nx048HpzetY/7R7/upnmi6LYK4myLEkp8UFkZhRFgbvTK3uHPbGgzL/Q2F99ab/2l7yPxPvkj771rU2tNP6kSD9jIftInodWSom6rnF3RkASWZZhZlRVvZZS+gbR/01K9r/m5/e2eR+IW+yll16aXOvZJ4NlP+vwl8Bxd9ydkcuThCQuEvyh47/WzOs/fOCBB5a5hcQt9Nzzr34OpX9gso/meW5lWTJy7RqNBmVZpuTpWZN+5bGH932BW0TcAt84eHhfYf5PzcJn8zyMVVVFSomR62dm5HlOVVUdd/+dKP/l+Yf2HeYmEzfZN1/49mdk4ZeD2d4YI+7OyM0jiRACMaXDnuLPPf7Ih7/ITSRukmeeOTJbtDpP5Xn2k0JFXdeM3DpZluF4WVX1b5RrY0997GO7z3MTiJvgT174s+/KVPyqmf0VB1KMjNx6FgICUkpfq5L/9Ece3XeIGyRu0MLzL39vHrL/ZCHbU1UlI++/oiioY/1qjOnHn3hk3ze4AcYNeO75lz+XWf55C9meqioZuT3KsiQL2YdCCF987vmXP8cNENfp4MFv/02F8O9DFmaqqmLk9svznKqqF93rn3zi0Qee5jqI63Dw4KsfsyI8bdLOqqoYuXNkeY5HP5bq+LnHHvvQ/+EaGdfo+UNv7E9KvxvMdlZVxcidpa4qQmY7k9Lv/MkLr34X18i4Bi+//PJcqsvfKIri3rIsGbkzlWVJURT3mqdfP3jw9RmugXGVnj50qFju8EtZln+8rmtG7mx1XZNl2fcmq//F04cOFVwl4yrt6eWfaRSNH0sp4u6M3NncHXenKPKf2NPLP8NVElfhmYXXH2hm9VeyPNtV1zUjgyPLMqq6PpI1wg888sB9L/MejPfg7qGZx1/I8mxXXdeMDJa6rsmzbHcs0y+4u3gPxnv45vOv/Djw2RgjI4Mpxoh7+uzBb732o7wH4woOHTo0i/jZRqMI7s7IYHJ3mo1mllL8J4cOHZrlCowr6FXFD+Z5/lhZlowMtrIsKfLssbWq+EGuwLiMF188utnxfwzC3RkZbO4OMjLpHx46dGiWyzAuY7Vc/XSe54/UdcXIcKjripCFxzp19kNchvEuFtxzob/t7owMF3cHt79z6NChgndhvAu98O1PC313SomR4ZJSwown6nrsr/IujEu4uwz7a0XRaLg7I8PF3SnyRjN6/Ky7i0sYl3juudd2J/yjjjMynBzH3b/nuT97bTeXMC5hef2xZrO5t64qRoZTXVU0x5p7rea7uYTRZ2FhIcf1lyUzd2dkOLk7to4UP7GwsJDTx+gzNrZ5c4JPVlXJyHAryxI3fTLPd22ij9GnrtPH8yy7L8bIMHMHd6efJCQhiX7uzjCKMZKFsJew9lH6ZPSpPT2ZERhW7g4OeZHRbBZMTbRoNHIaRU6eZ1zkQK9bUteRlbUOy8sdyqqijgmTGDaxjp8EvsTbxNsWFjy3/PCCmT2cUmTYuDtZyJiZHmfz7BTj402uRkpOu73ChfYK7aVVHBDDwSyQUvpWqvbOz8+rYl3G26zx2iMkv9txho27MzXR4q675miNNbgWZmLTpklmZiZYWl7j+ImzrHVLTGLQOQ743dZ47RFggXXGhhjngXHcGSbusGVuhvv23EVrrMH1ksT01Dh77tnB9GSL5M7Ac2fdODHO87aMtznaX+R5Xtc1w2Ru8xS7dswhE5fqdEu63ZJeryLGyIYsy2g2c8aaBUWR06/ZLLh39zZef/MUyytrSGKQ5euqqn6Qt2WsW1hYyCV/MISMqqoYBsmdmalxdu/cgiT6dbolx0+eY22tS1nVeHIk3uEOIRhFkTM91WL71lmyLLAhyzPu3r2Vw68fp9MpMRODyN0JIaOsqweedg9/Q4rGujrPt0nakVJkGLg7Y82CnXfNIYl+Z8+1efW1Y7TbK1RVjUmEYJgZZoaZEYJxUa9XcvrMIoe/c5zllQ79GkXOjm2zhGAMspQiBrs+/MK3t7POWJer2Obu22JMDAWJudkpmo2CfufOL3H0+FnqOiIJSVyJJCSxutbjO2+eZGW1Q7+Z6QkmJ8ZwdwZVjAl33xYtbWedsU61bc3yYlNKkUHnDq1mwezsNP1WVjscOXaGlBLXSkBV1bx59DS9smKDJLZvm8XMGFQpRbK82KTatrLOuCjXPY2iMHdn8DnT0+NkwdgQU+L0mUViTEjiekhirdPj3Pkl3J0NrbEGE+NjuDuDyN1pFIWR6x7W2VNPPWVy9sSYGA5ivNWk3+pql/bSKmbiRpjEhcVlyqpmgyQmJpoMshgTcvY89dRTZj/yIz8yhof7UooMOnen2chpNhr0ay+t4u7cKEn0ehVrq136jbfGcHcGVUoRT7rnkz/xEw2rquaYe/pQSolhYCZkYoO7s7bWBcTNstrp0S/PAkWe4e4MopQSLvZOLzFmNjFWIO5KKTEMzAyT2OAOvV6FxE1T15FhklLC4O5e8KbFstsE5lJKDDp3JwTDTNw6oqpq3J0NFkTIAoMqpYTjc1npTfNau20dI9dNEpIYZGbB3Mutlme+k5GRdSW+00TY7Yx80Dlgib2Zu88xMuKOmW0x9zTLyMg69zRr7ppj5Iak5KTkDDp35gzTJoaIu+POnydx8zghC4DY4MlJMTIEpk34GENCEnUdiSmxQYJGkXMzNYoMiXe4O8kZeAoaN/Bpd2dY1HUkxcQGSYyPN3F3bgYHWq0m/eqYqGNEEoPKHUjeMpxxhoQkyqqmrGr6TU22uBncodnIaY016Le62mHwOY6PG7Ixhog7rKx06NcaazA52SKlxI1wd2ZmJinyjA3uzvJqBzH4pDBl7ilniJiJ84tL1HVkQ5YFts7NEIJxvdydRiNnbtMkktiwttZjda2LJAad45lJajBkyl7FhfYK/aanxtk8O427cz0ksW3LDI1GQb+z59qk5AwDgQzIGTIOnD3bpqpq+u3YNsvM9ATuztVy5y1b5maY2zxDv6XlNdrLq+DOMHBnzBhCkuh0exw/cQ7c2ZBlgXvv3sZd2zdzNdwhBOPu3dvYuWMOiXfUdeTEyfPUdUQSw0AiGENKEhfaK5xfXKGfmbF92ywz0+O4O1ciwY5tm9i8aRKJP+f4qXOsrnWQxDAxhpi78+axM5w51+ZS27fNEoJxOe7QbOTMbZ6mX4yJYyfOcu7cEpIYJu5EAyqGkLvj7nhKnDp9gfbSKv2aRQGIy3PGWg3MjH5nzi5y5mybi9wdd2dYSHQyd+9JyhkSKSXMjGazYLw1xvRki1arQZ5n9HOcKxNVWQMOiA1bt2xi08wEy6td2u0VOt0eZVlzkSQGmYNnklXgDDp3kGB20ySzm6ZotRrkWcblLLZX8JS4HAk63YqqiuR5xgYz0WgUNBoFc7NT9HoVK6sdzl9YZnmlg8TAEqozPHWQNjGg3J2LpibH2To3zfj4GCEYV9IrK06dWSS5I4nLqeuaY8fPcs/ubcjEu2k0chqNnOmpcdpLq5w6c4Fut0QSA8dTJ3PREYPJ3cnyjC2bZ9i2ZQYzcTkpJcqqZm21x5nzbTqdHpK4EkmcX1zmoi1zMxRFRp5nvJssC2yenWJqssWxE2e5sLjCwBGrmdCaJNydQeLujDUb3LN7K61Wk3cTU6K9tMraWo9Ot0e3W1KWNZKQxNWQxPnFZS60V2g0cpqNgmazYHKixeTEGJfK84x7795Oq7XIseNnGRSScKedOWqLweLu5HnG7l1baLWaXKosay60l7mwuEKvV1LXERASmIlrJYmLut2STqeHJM6dazM+PsbMzASbpieQRL+tczNcdPTYGSQxCDz5akby8wQxSExi65ZNTIyP0S8l58LiMidPX6BXVuCOJMyMm0ESkrioqiOL7RXaS6ucbbXZuX0z4xNj9NuyeZqV1Q6LiytIYgC0TfKzDBB3p9VqsmXzNP26vZLX3zjBG0dOU5YVAiRxq0hCEhetrHZ49TvHOXbiLO68QxI7ts1SFBnuzp1O4qxJdp4BIomZ6QnMxIYYE0ePnWGxvYLE+04SMTmnTi9y4tR5+o01G7TGmgwCyc6ZpLNIDAoBE+NN+rWXV1laXsPMuF3ERc7Zc21W13r0m5gYQxJ3Mkko00lz4hExQCSKRkG/zloPd+d2k0RZVnS7Pfo1ipxBEFM6ak5+jAET60S/PA+4c0cIwciyQL+6jgyExJtmqXvCnYHh7nQ6XfpNTU0wNlaQUuJ2SsmZmmwxOTFGv0635E6XPKUkP22pOb7ins6YGYPA3Tl3YQl33tFs5Ny9ayvjrSbuzu2QkrNpeoK7d23FzNhQVjXLK2u4c8cyM3BOhzp1rXLrJeeYmTEIJLG80qHdXqHf5ESLe+/Zzsz0BBe5O+7OreTuuDtmYsf2We65eyt5ntHv3Pk23W4PiTuWmZGSn2y3V8qsWZ7rRlqHzexRBkSMiROnzzM+3iTPMzY0GwX33buDxfYKZ88t0en2KMsKJEziZnB33HlLo5Ez3mqyZW6aifExLrWy2uXsuSXcQeKOZWaY6fDsbN4J27dvjw/8hYcez/PGx+u6ZhBIoqpqOt2S1liDPMvo12wWzG6aZHKixVizgZlR1ZEYIxskcbXcnYscaBYF09PjbNsyzfZts2zZPE1R5FyqvbTKkWNnKMsKSdzJ8rwgxur3/8vvfeG/iXXf/NNv/9T42MSvr66uMkhScsbGGuzeOcfkRIvLiTFR1TWdTo9Op6SsKjrdkqqqucjdAdFP4i2NRkGzyGk0C8bHGhSNnDwLmBnvxt05f2GF4yfPUlU1krjTjY+Ps9rp/L3HH9r7HzIuqvyNXiiTJHN3BoWZ6HZLXvvOSbZtmWF2dooiz7hUCEYIBc1GwaYZ3uLuXFTXkaqqAdGvKDJCMEBIXJVur+TU6Qucv7CMA5K400miV5bRk3+HdRnrPEun66q8EEK+OcaaQSJBSoljJ89x/sIy09PjbN40RbNZcCWSuCjPM/I847o5rKx1OH9hmfbSKlVVIwkxGEIIVFV1LiY/ybqMdZVnpwo4HYJtjpGBZBLdXkn3dMni4gpjrQabpsaZnBzHzDATN0tKiTom2u0VFpdW6XZLqqrmIkkMEjOD5OeS6SzrMtZlVfsU+dRxs/AgA0wSF/XKil5Z0W6vYmaMt5q0Wg3GW03yPCOYYcEIZki8RRJvcXCci5I7KSZiSsSYqKqa1bUuq6td1jo93B13B4QkBpFZQMbxrGqfYl3Guvn5+eq55195Mcb6E5JwdwaZJDaklFhaXqW9vAruZFkgC4EQAiEYZuIiSWQhUMcad94SUyLGRIyJuqqJKSGJiyRxkSQGlSRirHHXi/Pz8xXrMt4m/FC1TlLOkJGEWCcRoxNjBVS4s87Z4A4SfYTEWyRhZgybap3wQ7wtY0MIC6S0ijSDO8NKYp24SGKd+MCSwH2VEBZ4m/G21LvvBZzjQox8MAgBejP17nuBtxlvm59XJfyPJUY+ICTA/X/Pz6vibUaf6P4HjHygyPhD+hj9Yny2jvFwCIGR4RZCoKrr14qQPUsf489ZOyv4H0VRMDLciqLAXP+90zl3jj5Gn/n5+cqMr7mTJDEynCThkBTCgfn5+Yo+xiXqnn2js7Z2OMtzRoZTlud0VtcOx9Kf5RLGJZ544r4jMn1DiJHhJISkbzzxxH1HuIRxCUmuFL9YVmVXEiPDRRJlWXYU7POSnEsY76Io4h+kFJ8zM0aGi5nh8Fxh3a/wLox3sX///hLxm5IYGT5O/I/79+8veRfGZcRu+v0Y0wtZljMyHPI8p47x4FhWf4nLMC7jox998FyS/hWekMTIYJNEdI/C/+X+/fvPcxnGFTSt8+Wqrg8WRcHIYCuKglRV30xV+DJXYFzB/v37z+P8216vjJIYGUyS6Pa6NeJX5uf3trkC4z08/ui+3wa+EEJgZDCFEJDsC489/OH/zHsw3oOkmCn8Yl3HN7IsY2SwZFlGXcc3PPDPJZz3YFyFhx/e81KM6ecl9cyMkcFgZkjqxZh+/on9H3qVq2Bcpdcb1Rd7ZflbkpDEyJ1NEpLoleVvvd6ovshVEtfg4MHXZ5KqLxVF8b1VVTFy58rznLIs/9g8/6HHHtuzyFUS1+j5Q2/sT3X5paIo9pRlycidpygKer3ud0Le/PSj++85xDUwrtGj++85lFv+YymlY1meM3JnyfOcmNIx8/S3Ht1/zyGukXEdHnro3meqqveP6qpezPOckTtDnufEOp6vq/JnHnvswWe4DsZ1euLRB552jz8VUzqeFwUjt1deFMSUjsdU//0nHr3/97hO4gZ981uv/MXMst+2YHvLsmTk/VcUBSmmw3Wqf/zxh/d9nRtg3KDHH9739eVO54erqvxaCAELgZH3RwgBM6Oqyq8tdzo//PjD+77ODRI3yTPPHJpttopfDFn4u5KKuq4ZuXWyLAO8rOr4a7NT2S/u2bNnkZtA3GTffOHbn5GFXw5me2OMuDsjN48kQgjElA57ij/3+CMf/iI3kbgFnjt05EMqu//MivDZPGRjVVWRUmLk+pkZeZ5TVXXHU/zdzPilhx7ad5ibTNxCzz3/8udk9rNC31MUhfV6PUauXaPRoCzLlDw9i+tfP/Hovqe5RcQt9tJLL02ulNknMvTTSJ9gnXvC3Rm5PElIxlvcv1rj/26iqL/6wAMPLHMLiffJwsLh6azh3x+T/3Sw8D15nrVSSlRVxcj/J4ksyzAzqqpe8xifVch/te7F/zk/v7fN+0C8zw4cOJBtmtv9QzH6j0r6SLPZuJd1ZVmSUuKDyMwoigJ3pyzLw8lZCMbnL5w98qUnn3yy5n0kbqNnn3/xwznZRy2z708x/UCWZTvdHXfHnXWOuzNMJAFCAkkgker6GOiryf0rReDrDz207zC3ibgDvPLKK43l2NisMn4kef0pwfch3YX7RFEUFkIgxkRKkRgj7s4gkEQIAbNACEaMkbIsk6Tl5H5C8MdK+q9jY8X/PXEinn/yyT1dbjNxB3r99debF5bSx5PXjwjdn4WwK6a0HfddeVFszfOClCIpJVJy3BMpJdyd20ESZoZkmAkzwyxQVSVVWZ5GOhrMTtYxHhV62dDB48f9mU99al+PO4wYEAsLL8+loF3BtNukBx124WmHwzbDtjpst2DTuLPB3dng7twISWyQxDskUkxtwUmH08JPuXRCcDS5vxiTH7HoR+fn7z/LABAD6sCBA9nk5P1FCL3CLBbgRV03m1bUu1Ksd+HpboydIuwC3+74FM4UMG1m4+7OlUgipbQKtBFLcpZcnJTszRT9uMQRC9nRVGZHs6zbBZUphTLGRrm8/HL55JNP1gyg/wdxiB89WDkdFQAAAABJRU5ErkJggg==',
}

interface Props {
  src: string
  customClass?: string
  width?: number
  type?: 'metafile' | 'metaId'
}
const props = withDefaults(defineProps<Props>(), {
  width: 235,
  type: 'metafile',
})

const imgRef = ref()

const imageClass = computed(() => {
  return props.customClass ? props.customClass + ' image lazyload' : 'image lazyload'
})

const isSkeleton = ref(true)
const url = ref('')

// 格式有问题的txid 要过滤不存本地
const filterTxids = [
  'metafile://09785e0ff9fffaee15a6e8f25b4390e86ed6a3646843bce2884a7a95c45e64d1.gif',
  'metafile://a48ac7831ceeacf283ad78da7edee14533b3e8992a33c0ec8d79322dc74e2f05.gif',
  'metafile://1a6346211a21d76aa82cf13f8c81ca17ea77607c729c904eb234a35b2e4c9643.gif',
  'metafile://a1e47d9f8ac015377353e5a507e8d802b4f1bbf679c14059dcd800f2d73bb66c.gif',
  'metafile://6d4c57fba123b8769495c76e22c7b90057e6ce32d443940c822c86d1a08c7c7a.gif',
  'metafile://b508e32cde3583bad834448fc474d46a81da06a760320d6e41fa2f4d68017319.gif',
  'metafile://46cd5737cab0806af07ed33de7487ddb793d1510c5bc32f9f2065c2aac464175.gif',
  'metafile://c878d8380aeefda88dd65246cf967748e3a46726fe0c7439b3b801aaad9cb129.gif',
  'metafile://0dc2634838fbd0a5d15649c9392d4c00f46bc491604f7918bc4f58445722a0a1.gif',
  'metafile://6d83a80c470c85cdf56c6f402bd810404c931b0408a986b73c1ee30c97ac0e49.gif',
]

// setTimeout(async () => {
//   let src = props.src
//   if (filterTxids.includes(props.src)) {
//     src = await metafile(props.src, -1)
//   }
//   DB.getMetaFile(src, props.width).then(res => {
//     if (res === '') {
//       console.log({ src })
//     }
//     url.value = res
//     isSkeleton.value = false
//   })
// })
getImageUrl()
watch(
  () => props.src,
  () => {
    getImageUrl()
  }
)

async function getImageUrl() {
  isSkeleton.value = true
  let src = props.src
  if (filterTxids.includes(props.src)) {
    src = await metafile(props.src, -1)
  }
  DB.getMetaFile(src, props.width, props.type).then(res => {
    url.value = res
    isSkeleton.value = false
  })
}

function fail(event: any) {
  const img = event.srcElement
  img.src = props.type === 'metafile' ? Default.metafile : Default.metaId
  img.onerror = null // 防止闪图
}

defineExpose({
  imgRef,
})
</script>

<style lang="scss" scoped src="./Image.scss"></style>
